<section class="yze-actor-sheet">

  <header class="yze-header">
    <div class="yze-title">
      <h2 class="actor-name">{{actor.name}}</h2>
      {{#if yze.hasActiveSetting}}
        <p class="hint">Active setting: <strong>{{yze.activeSetting.name}}</strong> ({{yze.activeSetting.id}})</p>
      {{/if}}
    </div>
  </header>

  {{#if yze.hasActiveSetting}}

    {{!-- ATTRIBUTES --}}
    <section class="yze-block">
      <h3>Attributes</h3>

      <div class="yze-grid yze-grid-attrs">
        {{#each yze.activeSetting.attributes as |attr|}}
          {{!-- Fetch current value safely --}}
          {{#with (lookup ../system.attributes attr.id) as |a|}}
            <div class="yze-row yze-attr" data-attr="{{attr.id}}">
              <button type="button"
                      class="yze-roll"
                      data-action="rollAttr"
                      data-attr-id="{{attr.id}}">
                Roll
              </button>

              <label class="yze-label">{{attr.name}}</label>

              <input type="number"
                     class="yze-input"
                     name="system.attributes.{{attr.id}}.value"
                     value="{{a.value}}"
                     min="0"
                     step="1"
                     {{#unless ../editable}}disabled{{/unless}} />
            </div>
          {{/with}}
        {{/each}}
      </div>
    </section>

    {{!-- SKILLS --}}
    <section class="yze-block">
      <h3>Skills</h3>

      <div class="yze-grid yze-grid-skills">
        {{#each yze.activeSetting.skills as |skill|}}
          {{#with (lookup ../system.skills skill.id) as |s|}}
            <div class="yze-row yze-skill" data-skill="{{skill.id}}">
              <button type="button"
                      class="yze-roll"
                      data-action="rollSkill"
                      data-skill-id="{{skill.id}}"
                      data-attr-id="{{skill.attribute}}">
                Roll
              </button>

              <label class="yze-label">
                {{skill.name}}
                <span class="yze-subtle">({{skill.attribute}})</span>
              </label>

              <input type="number"
                     class="yze-input"
                     name="system.skills.{{skill.id}}.value"
                     value="{{s.value}}"
                     min="0"
                     step="1"
                     {{#unless ../editable}}disabled{{/unless}} />
            </div>
          {{/with}}
        {{/each}}
      </div>
    </section>

    {{!-- RESOURCES --}}
    {{#if yze.activeSetting.resources}}
      <section class="yze-block">
        <h3>Resources</h3>

        <div class="yze-grid yze-grid-resources">
          {{!-- resources is an object, iterate key/value --}}
          {{#each yze.activeSetting.resources as |res resId|}}
            <div class="yze-row yze-resource" data-resource="{{resId}}">
              <label class="yze-label">{{res.name}}</label>

              {{!-- Value --}}
              <input type="number"
                     class="yze-input"
                     name="{{res.path}}"
                     value="{{getProperty ../system (replace res.path "system." "")}}"
                     min="0"
                     step="1"
                     {{#unless ../editable}}disabled{{/unless}} />

              {{!-- Max (optional) --}}
              {{#if res.maxPath}}
                <span class="yze-subtle">/</span>
                <input type="number"
                       class="yze-input yze-input-max"
                       name="{{res.maxPath}}"
                       value="{{getProperty ../system (replace res.maxPath "system." "")}}"
                       min="0"
                       step="1"
                       {{#unless ../editable}}disabled{{/unless}} />
              {{/if}}
            </div>
          {{/each}}
        </div>
      </section>
    {{/if}}

  {{else}}

    <section class="yze-block">
      <p class="warning">
        No active setting. Activate or load a setting to display attributes, skills, and resources.
      </p>
      <p class="hint">
        (Dev) If you expected the example setting: enable <em>Enable Dev Example Setting</em> and reload the world.
      </p>
    </section>

  {{/if}}

</section>
